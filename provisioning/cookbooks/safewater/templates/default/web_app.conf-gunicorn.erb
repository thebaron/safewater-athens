<VirtualHost *:80>
  ServerName <%= @params[:server_name] %>
  ServerAlias <% @params[:server_aliases].each do |a| %><%= a %> <% end %>
  DocumentRoot <%= @params[:docroot] %>
  RewriteEngine On

  DirectoryIndex index.php

  Alias /media/  <%= @params[:docroot] %>/assets/
  Alias /assets/ <%= @params[:docroot] %>/assets/
  Alias /images/ <%= @params[:docroot] %>/images/
  Alias /django-assets/ <%= @params[:docroot] %>/django-assets/
  Alias /index.php <%= @params[:docroot] %>/index.php
  Alias /squeal.php <%= @params[:docroot] %>/squeal.php

  <Directory <%= @params[:docroot] %>/assets>
    Options Indexes
  </Directory>

  ProxyPass /media !
  ProxyPass /assets !
  ProxyPass /images !
  ProxyPass /django-assets !
  ProxyPass /index.php !
  ProxyPass /squeal.php !

  ProxyPass / http://127.0.0.1:8000/
  ProxyPassReverse / http://<%= @params[:server_name] %>:8000/


  LogLevel info
  ErrorLog <%= node['apache']['log_dir'] %>/<%= @params[:name] %>-error.log
  CustomLog <%= node['apache']['log_dir'] %>/<%= @params[:name] %>-access.log combined


</VirtualHost>
